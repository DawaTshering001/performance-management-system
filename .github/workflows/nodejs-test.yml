name: 🚀 CD - Docker Build & Verification

on:
  push:
    branches: [ main ]

jobs:
  build-and-verify:
    runs-on: ubuntu-latest
    name: Build & Verify Docker Image

    steps:
      - name: 🛎️ Checkout repository
        uses: actions/checkout@v4

      - name: 🧱 Build Docker image
        run: docker build -t performance-app:latest .

      - name: 🧩 Start Docker container
        run: |
          docker run -d \
            --name performance-app-test \
            -p 4000:4000 \
            performance-app:latest

      - name: 🪵 Show container logs
        if: always()
        run: |
          echo "===== Container Logs ====="
          docker logs performance-app-test || echo "No logs found."

      - name: 🧹 Cleanup
        if: always()
        run: |
          echo "🧹 Cleaning up Docker..."
          docker stop performance-app-test || true
          docker rm performance-app-test || true
